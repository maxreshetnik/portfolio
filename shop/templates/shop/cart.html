
{% extends "shop/base.html" %}
{% load decimal_normalize %}
{% load get_cart_form from cart_form %}

{% block title %}
<title>Cart - Shop</title>
{% endblock %}

{% block breadcrumbs %}
<ol class="breadcrumb ms-lg-4 ps-lg-4">
    <li class="breadcrumb-item"><a href="{% url 'shop:home' %}" class="text-decoration-none">Home</a></li>
    <li class="breadcrumb-item">
        <a href="{% url 'shop:profile' %}" class="text-decoration-none">Account</a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Cart</li>
</ol>
{% endblock breadcrumbs %}

{% block content %}

<h4 class="text-start ms-lg-5">Product{{ cart|length|pluralize }} in cart</h4>

<div class="row gx-4 gx-xl-5 justify-content-end">
    <div class="col-12 col-lg-7 mb-5 ms-xl-4 mt-4">
    {% for spec in cart %}
        <div class="row text-start small justify-content-start border border-1 mb-3">
            <!-- Product image-->
            <img class="col-2 p-1"
                 src="{% if spec.image %}{{ spec.image.url }}{% else %}{{ spec.product.image.url }}{% endif %}"
                 alt="..." />
            <!-- Product details-->
            <div class="col p-2">
                <!-- Product name-->
                <a class="text-dark text-decoration-none" href="{% url 'shop:spec_detail' spec.product.category.category.name|lower spec.product.category.name|lower spec.id %}">
                    <h6 class="fw-bold">
                        {{ spec.product.category.name }} {{ spec.product.name }}
                        {{ spec.product.marking }} {{ spec.tag }}
                    </h6>
                </a>
                <!-- Product price and quantity -->
                price: ${{ spec.customer_price }}<br>
                quantity: {{ spec.cart_qty|decimal_normalize }} {{ spec.product.get_unit_display }}{{ spec.cart_qty|pluralize }}
            </div>
            <!-- Product actions-->
            <div class="col-3 col-lg-3 d-flex flex-column p-1 ms-auto">
                <form class="text-end" method="post">{% csrf_token %}
                    <input type="hidden" name="{{ form.specification.name }}" value="{{ spec.id }}" required>
                    <input type="hidden" name="{{ form.quantity.name }}" value="0" required>
                    <button class="btn text-secondary p-0" type="submit" aria-label="Remove from cart">
                        <i class="bi-trash"></i>
                    </button>
                </form>
                <h6 class="text-end fw-bold mb-2 me-3 me-xl-4 mt-auto">
                    <span class="bg-light rounded p-1">${{ spec.total_price|floatformat:2 }}</span>
                </h6>
                <form method="post" id="add-to-cart-{{ spec.id }}" action="{% url 'shop:cart' %}#add-to-cart-{{ spec.id }}">
                    {% csrf_token %}
                    {% get_cart_form spec spec.cart_qty form size='sm' min_qty=spec.pre_packing is_auth=view.request.user.is_authenticated %}
                </form>
            </div>
        </div>
    {% endfor %}
    </div>
    <div class="col-auto mb-5 ms-auto">
        <div class="text-start px-4 py-3 border border-2">
            <h5 class="">Total price: <span class="fw-bold">${{ total_cart_price }}</span></h5>
            <button class="w-100 fs-5 btn btn-primary mt-5" type="button">Buy</button>
        </div>
    </div>
</div>

{% endblock content %}

